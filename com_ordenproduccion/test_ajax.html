<!DOCTYPE html>
<html>
<head>
    <title>AJAX Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .result { background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e8; color: #2e7d32; }
        button { padding: 10px 20px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>AJAX Status Change Test</h1>
    
    <form id="test-form">
        <input type="hidden" name="order_id" value="1399">
        <input type="hidden" name="new_status" value="en_progreso">
        <input type="hidden" name="option" value="com_ordenproduccion">
        <input type="hidden" name="task" value="ajax.changeStatus">
        <button type="submit">Test AJAX Request</button>
    </form>
    
    <div id="result" class="result" style="display: none;"></div>
    
    <script>
        document.getElementById('test-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const resultDiv = document.getElementById('result');
            
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = 'Testing AJAX request...';
            
            fetch('/components/com_ordenproduccion/change_status.php', {
                method: 'POST',
                body: formData,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                    'Content-Type': 'application/x-www-form-urlencoded'
                }
            })
            .then(response => {
                console.log('Response status:', response.status);
                return response.text();
            })
            .then(text => {
                console.log('Response text:', text);
                try {
                    const data = JSON.parse(text);
                    resultDiv.className = data.success ? 'result success' : 'result error';
                    resultDiv.innerHTML = '<h3>Response:</h3><pre>' + JSON.stringify(data, null, 2) + '</pre>';
                } catch (e) {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = '<h3>Error parsing JSON:</h3><pre>' + text + '</pre>';
                }
            })
            .catch(error => {
                console.error('AJAX Error:', error);
                resultDiv.className = 'result error';
                resultDiv.innerHTML = '<h3>AJAX Error:</h3><pre>' + error.message + '</pre>';
            });
        });
    </script>
</body>
</html>
